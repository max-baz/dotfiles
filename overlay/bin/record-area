#!/bin/sh

pkill -x wf-recorder

[ $? -ne 0 ] && {
    systemctl --user stop sway-inactive-windows-transparency.service

    path="/tmp/record_$(date +%s)"
    notify-send -t 2000 'Screen recording' 'Select an area to start the recording...'
    geometry="$(waysip -s '#ff3f3faf' -w 2 -d)"
    pkill -RTMIN+3 -x .waybar-wrapped
    wf-recorder -g "$geometry" -f "$path.mp4"
    pkill -RTMIN+3 -x .waybar-wrapped

    systemctl --user start sway-inactive-windows-transparency.service

    echo "file://$path.mp4" | wl-copy -t text/uri-list
} &
